<!--
Interface utilisateur 
=====================

1 - Pour ajuster les configurations, il faudra absolument mapper le Server-Database-Schema courant dans une variable sinon les champs seront en lecture seule.
2 - Suite à la création d'une variable nous pourrons créer un template serveur/database ou schéma.
3 - Nous pourrons ensuite créer un behavior basé sur une variable ou un template.

Code 
====

MetadataStorage : Représente un fichier contennant les metadatas d'un contexte d'exécution. 
Metadata : Contient les informations d'un contexte d'exécution. Ce sont les metadatas des serveurs SQL suite à l'application de la configuration utilisateur.
MetadataBuilder : Génère les informations d'un contexte d'exécution soit les metadatas des serveurs SQL suite à l'application de la configuration utilisateur.
ServerMetadata : 
DatabaseMetadata : 
SchemaMetadata : 
TableMetadata : 
QueryHelper : 
QueryDispatcher : 

Fichier de configuration
========================

ConnectionStrings : 

1 - Représentent une connexion à un serveur SQL

Variables : 

1 - Le projet doit définir les variables de base pour l'intellisence ainsi que pour la substitution des valeurs par les maps.
2 - La valeur des variables de projet peut être écrasée au niveau des noeuds From et To pour les éléments de même clef.
3 - La clef des éléments serveur, database ainsi que schema représente toujours une variable. Ce fonctionnement permet une réutilisation des 
    modèles (templates) ainsi que d'une intégrité des valeurs car celles-ci sont validées lors de leur création.

Templates : 

1 - Par défaut les DbSettings sont réutilisables comme template de départ, pour une configuration spécifique d'un besoin.
2 - Lorsque l'on hérite d'un DbSettings en utilisant la propriété BasedOn, la propriétée Var est innaccessible car il faut absolument que les 
    éléments serveur, database et schéma soient identiques.
3 - Les templates ne peuvent pas hériter de plus d'un parent. Il faut donc se créer une hierarchie d'objets pour réutiliser au maximum les configurations.
4 - Deux noeuds ForeignKeyAdd ne s'additionnent pas s'ils sont identiques. Attention de ne pas définir deux FK avec un colonne partagée car elles s'additionneront.
5 - Un ForeignKeyRemove supprime également les ForeignKeyAdd hérités.
6 - Un ForeignKeyRemove est exécuté avant un ForeignKeyAdd.

Behaviors : 

1 - Les même règles que les templates sont appliquées.
2 - La création de templates dans les behaviors n'est pas supporté.

Maps : 

1 - Chaque noeud From représente la source de copie des données.
    L'attribut Name doit être unique à travers les autres noeuds From.
    UsableBehaviours représent les comportements, qui ont été conçues par l'utilisateur, spécifiquement pour cette source de données.
2 - Les variables définit à même le noeud From représentent majoritairement les points d'entrée.
3 - Les éléments To représentent la destination de copie des données.
    Les variables définies à même le noeud To représentent majoritairement les points de sortie.


Fichier de cache
================

1 - Les fichiers d'extension .dcc représentent la cache générée pour chaqucune des combinaisons source-destination (From-To) de l'élément Maps.
2 - Ils contiennent le schéma des bases de données suite à l'application de la configuration utilisateur.
3 - Ils permettent d'optimiser la copie.


Exemple de fichiers de configuration
====================================

Case simpliste (HelloWorld)  :

1 - De base, l'application permet de cloner vers et depuis deux serveurs ayant les schémas cibles identiques.
-->

<?xml version="1.0" encoding="utf-8"?>
<Project>
    <ConnectionStrings>
        <Add Id="1" Name="UNI" ProviderName="MySql.Data.MySqlClient" ConnectionString="server=UNI;user Id=root; password=toor;" />
        <Add Id="2" Name="FON" ProviderName="MySql.Data.MsSql" ConnectionString="server=FON;user Id=root; password=toor;" />
    </ConnectionStrings>
</Project>

<!--
Cas le plus extrême :

1 - Permet de copier de l'information ...
--> 

<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="0.1" Name="NorthWind">
    <ConnectionStrings>
        <Add Id="1" Name="UNI" ProviderName="MySql.Data.MySqlClient" ConnectionString="server=UNI;user Id=root; password=toor; database=master; pooling=true" />
        <Add Id="2" Name="FON" ProviderName="System.Data.Sqlite" ConnectionString="server=FON;user Id=root; password=toor; database=master; pooling=true" />
        <Add Id="3" Name="PROD_PGIS" ProviderName="System.Data.Oracle" ConnectionString="server=PROD_PGIS;user Id=root; password=toor; database=master; pooling=true" />
        <Add Id="4" Name="PROD_ARIEL" ProviderName="System.Data.PosgreSql" ConnectionString="server=PROD_ARIEL;user Id=root; password=toor; database=master; pooling=true" />
        <Add Id="5" Name="PROD_SIEBEL" ProviderName="System.Data.MsSql" ConnectionString="server=PROD_SIEBEL;user Id=root; password=toor; database=master; pooling=true" />
    </ConnectionStrings>
    <Variables>
        <Var Name="PGIS_FROM" Server="1" Database="pgis" Schema="dbo"/>
        <Var Name="ARIEL_FROM" Server="1" Database="ariel" Schema="dbo"/>
        <Var Name="SIEBEL_FROM" Server="1" Database="siebel" Schema="dbo"/>
        <Var Name="PGIS_TO" Server="1" Database="pgis" Schema="dbo"/>
        <Var Name="ARIEL_TO" Server="1" Database="ariel" Schema="dbo"/>
        <Var Name="SIEBEL_TO" Server="1" Database="siebel" Schema="dbo"/>
    </Variables>
    <Templates>
        <DbSettings Id="1" Var="PGIS_FROM" Description="Configuration par défaut serveur PGIS schéma DBO.">
            <Table Name="DomaineValeur" IsStatic="true"/>
            <Table Name="Transmission" IsStatic="false">
                <DerivativeTables GlobalAccess="forced" Cascade="true">
                    <Table Destination="PGIS_TO" Table="Demande" Access="NotSet" Cascade="false"/>
                </DerivativeTables>
                <ForeignKeys>
                    <Add Destination="SIEBEL_TO" Table="S_SRV_REQ">
                        <Collumn NameFrom="NoReferenceTransmission" NameTo="SR_NUM" />
                    </Add>
                </ForeignKeys>
                <DataBuilders>
                    <Collumn Name="col1" BuilderName="Client.Builder.CreatePK" />
                </DataBuilders>
            </Table>
            <Table Name="PropositionRachat" IsStatic="false">
                <ForeignKeys>
                    <Add Destination="ARIEL_TO" Table="S_SRV_REQ">
                        <Collumn NameFrom="NoReferenceTransmission" NameTo="SR_NUM" />
                    </Add>
                    <Remove Column="ID"/>
                </ForeignKeys>
                <DataBuilders>
                    <Collumn Name="col1" BuilderName="Client.Builder.CreatePK" />
                </DataBuilders>
            </Table>
        </DbSettings>
        <DbSettings Id="2" Var="ARIEL_FROM" />
        <DbSettings Id="3" Var="SIEBEL_FROM" />
    </Templates>
    <Behaviours>
        <Behaviour Id="1" Name="Default" Description="Configuration par défaut">
            <DbSettings BasedOn="1"/>
            <DbSettings BasedOn="2"/>
            <DbSettings BasedOn="3"/>
        </Behaviour>
        <Behaviour Id="2" Name="Customer" Description="Duplication d'un client">
            <DbSettings Id="0" Var="PGIS_FROM" BasedOn="1" />
        </Behaviour>
    </Behaviours>
    <Maps>
        <From Name="UNI" UsableBehaviours="1">
            <Var Name="PGIS_FROM" Server="1" Database="pgis" Schema="dbo"/>
            <Var Name="ARIEL_FROM" Server="1" Database="ariel" Schema="dbo"/>
            <Var Name="SIEBEL_FROM" Server="1" Database="siebel" Schema="dbo"/>

            <To Name="UNI">
                <Var Name="PGIS_TO" Server="1" Database="pgis" Schema="dbo"/>
                <Var Name="ARIEL_TO" Server="1" Database="ariel" Schema="dbo"/>
                <Var Name="SIEBEL_TO" Server="1" Database="siebel" Schema="dbo"/>
            </To>
            <To Name="FON">
                <Var Name="PGIS_TO" Server="2" Database="pgis" Schema="dbo"/>
                <Var Name="ARIEL_TO" Server="2" Database="ariel" Schema="dbo"/>
                <Var Name="SIEBEL_TO" Server="2" Database="siebel" Schema="dbo"/>
            </To>
            <To Name="PROD">
                <Var Name="PGIS_TO" Server="3" Database="pgis" Schema="dbo"/>
                <Var Name="ARIEL_TO" Server="4" Database="ariel" Schema="dbo"/>
                <Var Name="SIEBEL_TO" Server="5" Database="siebel" Schema="dbo"/>
            </To>
            <Road Source="PGIS_FROM" Destination="PGIS_TO"/>
            <Road Source="ARIEL_FROM" Destination="ARIEL_TO"/>
            <Road Source="SIEBEL_FROM" Destination="SIEBEL_TO"/>
        </From>
    </Maps>
</Project>